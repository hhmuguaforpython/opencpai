# OpenCPAi-Web UI 版本管理

> 记录不同版本的App.js设计思路，方便切换使用

---

## 📁 版本清单

| 文件名 | 版本号 | 行数 | 核心特征 | 推荐场景 |
|--------|-------|------|---------|---------|
| `App_v1_classic_demo.js` | V1.0 | 464 | 经典Demo版 | 演示、客户展示 |
| `App_v2_dual_mode.js` | V1.5 | 829 | 审计+咨询双模式 | 功能测试 |
| `App_v2_0_full_scoring.js` | V2.0 | 829 | 完整6维度评分+文件规范 | 已弃用 |
| `App_v2_1_backup.js` | V2.1 | 829 | V3更新前备份 | 回滚参考 |
| `App_v3.js` | V3.0 | 830 | 统一文件卡片UI + 状态管理修复 | 已弃用 |
| **`App_v3_1_hybrid_layout.js`** | **V3.1** | 1154 | 混合布局：审计居中/咨询带侧栏 | ⭐ **当前主力版本** |
| `demo_v2_6_with_scoring_backup.py` | V2.0后端 | 1592 | Demo完整流程脚本 | 后端参考 |

---

## ⭐ V3.1 混合布局版（2025-12-22）

**文件**: `App_v3_1_hybrid_layout.js`  
**关联后端**: `main.py` (FastAPI 端口 8001)

**核心改进**:

### 1. 模式差异化布局
- ✅ **辅助审计**：主区域居中（`max-w-5xl mx-auto`），无右侧聊天栏，使用浮动按钮
- ✅ **辅助咨询**：保留右侧AI聊天侧栏（420px），紫色主题

### 2. 代码简化
- ✅ 右侧栏只在咨询模式渲染，移除审计模式的条件判断
- ✅ 咨询模式UI使用固定紫色主题，不再需要 `themeColor` 变量
- ✅ 浮动聊天按钮在审计模式始终可见

### 3. 用户反馈
- ✅ 审计模式：用户希望简洁居中，V2.1风格
- ✅ 咨询模式：用户满意V3右侧栏设计

---

## ⭐ V3.0 统一文件卡片版（2025-12-22）

**文件**: `App_v3.js`  
**关联后端**: `main.py` (FastAPI 端口 8001)

**核心改进**:

### 1. 统一文件识别卡片UI
- ✅ Demo模式和文件上传模式使用**完全相同的UI组件**
- ✅ 新增 `FileCard` 组件：彩色分类卡片（蓝、绿、紫、橙）
- ✅ 新增 `EmptyFileCard` 组件：虚线边框上传提示
- ✅ 四类文件统一展示：科目余额表、序时账、财务报表、上年审计报告

### 2. 状态管理修复
- ✅ 新增 `resetState()` 函数：切换模式时清空所有状态
- ✅ 新增 `filesSource` 状态：区分 'demo' / 'upload' / null
- ✅ 新增 `recognizedFiles` 对象：统一管理四类文件识别结果
- ✅ 修复"先上传后Demo报错"问题

### 3. 后端API集成
- ✅ `handleDemoClick()` → 调用 `/api/demo-sample-v2`
- ✅ `handleFileUpload()` → 调用 `/api/upload-and-unpack`
- ✅ `handleStartProcessing()` → 调用 `/api/run-full-pipeline`

### 4. UI美化
- ✅ 文件卡片带状态徽章（已识别/必传/可选）
- ✅ 处理日志实时展示
- ✅ 进度条动画
- ✅ 完成后下载区域

**状态对象结构**:
```javascript
const [recognizedFiles, setRecognizedFiles] = useState({
  balance: null,      // 科目余额表 { name, status }
  journal: null,      // 序时账
  statement: null,    // 财务报表
  prior_report: null, // 上年审计报告
});
const [filesSource, setFilesSource] = useState(null); // 'demo' | 'upload' | null
```

---

## ⭐ V2.0 完整评分版（2025-12-19）

**文件**: `App_v2_0_full_scoring.js`  
**关联后端**: `demo_v2_6_with_scoring.py`

**核心特征**:
- ✅ 完整9步处理流程
- ✅ 6维度评分体系（总分100分）
- ✅ 统一文件命名规范
- ✅ Z10工商信息纯Python API
- ✅ 上年审计报告PDF解析
- ✅ Z3-2利润表/现金流量表写入

**输出文件**:
| 类型 | 命名规范 |
|------|---------|
| 科目余额表 | 【科目余额表】公司全名(年份).xlsx |
| 财审底稿 | 【财审底稿】公司全名(年份).xlsm |
| 检查报告 | 【检查报告】公司全名(年份).pdf |
| 财审报告 | 【财审报告】公司全名(年份第N版).pdf |

**详细开发历程**: [Web端开发历程_V2.0.md](../../.github/docs/Web端开发历程_V2.0.md)

---

## 🎯 V1.0 经典Demo版

**文件**: `App_v1_classic_demo.js` (原 `App_backup_20250615.js`)

**核心特征**:
- ✅ 单一模式：只有审计功能
- ✅ 清晰的两栏布局：**上期审计报告** + **本期财务数据**
- ✅ 4类文件上传明确展示
- ✅ 模拟处理过程（47秒计时器 + 步骤日志）
- ✅ 右侧AI对话栏

**UI结构**:
```
┌────────────────────────────────────────────────────────────────────┐
│  Header: OpenCPAi Logo                                             │
├────────────────────────────────────────────────────────────────────┤
│  左侧主区域 (flex-1)                │  右侧AI对话栏               │
│  ┌──────────────────────────────┐  │  ┌─────────────────────────┐  │
│  │  上期审计报告 (PDF)          │  │  │  AI助手对话             │  │
│  │  • 审计报告.pdf              │  │  │  预设问题按钮           │  │
│  └──────────────────────────────┘  │  │  - 财务分析建议          │  │
│  ┌──────────────────────────────┐  │  │  - 审计风险提示          │  │
│  │  本期财务数据 (Excel)        │  │  │  消息列表...            │  │
│  │  • 科目余额表.xlsx           │  │  │  输入框                 │  │
│  │  • 序时账.xlsx               │  │  └─────────────────────────┘  │
│  │  • 财务报表.xlsx             │  │                             │
│  └──────────────────────────────┘  │                             │
│  ┌──────────────────────────────┐  │                             │
│  │  处理状态 / 下载按钮          │  │                             │
│  └──────────────────────────────┘  │                             │
└────────────────────────────────────────────────────────────────────┘
```

**优点**:
- 👍 逻辑清晰：输入→处理→输出
- 👍 别人容易理解
- 👍 演示效果好

**缺点**:
- 👎 功能单一，没有咨询模块
- 👎 没有后端真实连接

---

## 🎯 V2.0 双模式版

**文件**: `App_v2_dual_mode.js` (当前 `App.js`)

**核心特征**:
- ✅ 双模式切换：**辅助审计** / **辅助咨询**
- ✅ 审计模式：Demo体验区 + 智能上传区
- ✅ 咨询模式：审计三步法界面
- ✅ 独立的系统提示词

**UI结构**:
```
┌────────────────────────────────────────────────────────────────────┐
│  Header: 辅助审计 | 辅助咨询 切换按钮                              │
├────────────────────────────────────────────────────────────────────┤
│  [审计模式]                                                        │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  Demo体验区 - "47秒见证奇迹"                                  │   │
│  └─────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  智能识别上传区                                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│  ┌───────────────────────┐  ┌───────────────────────┐            │
│  │  上期审计报告         │  │  本期财务数据         │            │
│  └───────────────────────┘  └───────────────────────┘            │
├────────────────────────────────────────────────────────────────────┤
│  [咨询模式]                                                        │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  审计三步法界面 (理论→实践→分析)                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────┘
```

**优点**:
- 👍 功能丰富
- 👍 审计+咨询一体化

**缺点**:
- 👎 界面复杂，新用户容易困惑
- 👎 核心流程被淹没在功能堆叠中

---

## 🔄 如何切换版本

```bash
# 备份当前版本
cp src/App.js src/versions/App_current_backup.js

# 切换到V1经典版
cp src/versions/App_v1_classic_demo.js src/App.js

# 切换到V2双模式版
cp src/versions/App_v2_dual_mode.js src/App.js

# 重启开发服务器
npm start
```

---

## 🎨 版本演进建议

### 推荐方案：V3.0 模块化设计

**产品心理学原则**：
1. **渐进披露** - 先展示核心功能，高级功能藏起来
2. **认知负荷** - 一个界面只做一件事
3. **用户心智模型** - 与用户预期一致

**建议架构**：
```
首页（默认进入审计模式）
├── 辅助审计（主功能）
│   └── 经典的 4类文件 → 处理 → 3类输出
│
└── 辅助咨询（Tab/侧边栏/二级入口）
    └── 审计三步法对话界面
```

**设计要点**：
- ⭐ **审计为主，咨询为辅** - 咨询是审计的增值功能
- ⭐ **入口清晰** - 顶部Tab或侧边栏切换
- ⭐ **保持独立** - 两个功能互不干扰

---

**最后更新**: 2025-12-15
**维护者**: CTO
