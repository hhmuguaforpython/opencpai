# OpenCPAi Chat UI v1.0.1 Release Notes

> **版本**: 1.0.1  
> **日期**: 2026-01-02  
> **Git Tag**: v1.0.1  
> **Commit**: c74e325

---

## 📋 版本概述

Chat UI 1.0.1 是 OpenCPAi 对话式审计界面的第一个稳定版本，采用现代 AI 产品设计风格（参考 ChatGPT/Gemini/豆包）。

---

## ✨ 核心功能

### 1. 文件上传
- 支持拖拽上传 + 点击上传
- 自动识别4类文件：科目余额表、序时账、财务报表、上年审计报告
- 文件分类显示清晰（颜色标签区分）

### 2. 任务确认卡片
- 公司名称、审计截止日、报告类型、会计师事务所
- 所有字段预填充（来自用户设置）
- 一键启动引擎生成审计底稿

### 3. 用户设置（右侧滑出面板）
- Gemini/豆包风格的右侧400px滑出面板
- 分组字段：个人信息 / 事务所信息 / 审计默认配置
- localStorage 持久化存储

### 4. 用户菜单（ChatGPT风格）
- 点击头像弹出下拉菜单
- 菜单项：升级套餐 / 个性化 / 设置 / 帮助 / 退出登录
- 未实现功能显示"敬请期待"Toast

---

## 📁 文件上传方式对比

### Chat UI vs Web App 的关键差异

| 维度 | Chat UI | Web App |
|------|---------|---------|
| **上传入口** | 拖拽区域 + 📎按钮 | 独立上传页面 |
| **API端点** | `/api/upload-and-unpack` | `/api/upload-and-unpack` |
| **分类逻辑** | `_identify_file_type()` | 相同 |
| **任务创建** | 上传时自动创建 task_id | 相同 |
| **Pipeline触发** | 确认卡片→启动按钮 | 表单提交 |
| **状态轮询** | SSE + 轮询 | 轮询 |

### 为什么之前折腾很久？

**问题根源**：Chat UI 的简化流程 vs Web App 的完整流程

1. **Web App 流程**：
   ```
   上传文件 → 选择文件类型 → 填写公司信息 → 提交表单 → 执行Pipeline
   ```
   - 每个步骤独立，用户手动确认

2. **Chat UI 原设计**：
   ```
   上传文件 → [Jenny识别] → 确认信息 → 执行Pipeline
   ```
   - 试图让 Jenny LLM 自动识别公司名称等信息
   - 多了一层 LLM 调用，增加延迟和失败点

3. **Chat UI 最终方案（1.0.1）**：
   ```
   上传文件 → 确认卡片（预填用户设置）→ 执行Pipeline
   ```
   - 去掉 Jenny 识别环节
   - 直接使用用户 localStorage 中的设置预填
   - 用户只需确认或修改后点击启动

### 关键修复

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| 文件分类不一致 | "凭证"被识别为其他 | 修改 `_identify_file_type()` 增加"凭证"→journal映射 |
| 任务确认后无响应 | 前端未正确调用API | 简化为直接调用 `/api/run-full-pipeline` |
| 进度轮询不更新 | SSE连接问题 | 改用 setInterval 轮询 `/api/status/{task_id}` |

---

## 🛠️ 技术栈

- **前端**: 纯HTML/CSS/JavaScript（无框架）
- **后端**: FastAPI (Python 3.13)
- **存储**: localStorage（用户设置）
- **托管**: Vercel (前端) + 本地服务器 (后端)

---

## 📐 UI 组件

### 侧边栏
- 新对话按钮
- 历史对话列表（预留）
- 用户头像 + 名称 + 下拉菜单

### 主区域
- 消息列表（用户/Jenny）
- 文件上传区域
- 任务确认卡片
- 进度显示

### 设置面板（右侧滑出）
- 400px宽度
- ESC/点击外部关闭
- 分组表单字段

---

## 🔧 后端依赖

确保安装以下包：
```bash
pip install pywin32  # Windows COM自动化必需
```

---

## 📌 已知限制

1. 历史对话功能尚未实现
2. 用户认证/登录系统尚未实现
3. 升级套餐/支付系统尚未实现
4. 个性化设置（主题等）尚未实现

---

## 🔜 下一步计划

- [ ] 实现用户认证系统
- [ ] 添加历史对话存储
- [ ] 实现个性化设置（暗色/亮色主题切换）
- [ ] 添加审计报告预览功能

---

**维护者**: CTO合伙人  
**仓库**: OpenCPAi-Web

